# 🗿 古墳検出システム - Google Colab学習版

このノートブックでは、実際のGSI画像データを使用して古墳検出モデルを学習します。

## セル1: ライブラリのインストール

```python
# 必要なライブラリのインストール
!pip install torch torchvision
!pip install opencv-python
!pip install matplotlib
!pip install tqdm
!pip install PyYAML

# YOLOv5のクローン
!git clone https://github.com/ultralytics/yolov5
%cd yolov5
!pip install -r requirements.txt
```

## セル2: データセットのアップロード

```python
# データセットのアップロード
from google.colab import files
import zipfile
import os

print("データセットのZIPファイルをアップロードしてください...")
uploaded = files.upload()

# アップロードされたファイルを展開
for filename in uploaded.keys():
    if filename.endswith('.zip'):
        with zipfile.ZipFile(filename, 'r') as zip_ref:
            zip_ref.extractall('./dataset')
        print(f"データセットを展開しました: {filename}")
```

## セル3: データセットの確認

```python
# データセットの確認
import os

dataset_dir = './dataset'
images_dir = os.path.join(dataset_dir, 'images')
labels_dir = os.path.join(dataset_dir, 'labels')

print(f"画像ファイル数: {len(os.listdir(images_dir))}")
print(f"ラベルファイル数: {len(os.listdir(labels_dir))}")

# サンプル画像を表示
import matplotlib.pyplot as plt
import matplotlib.image as mpimg

sample_image = os.path.join(images_dir, os.listdir(images_dir)[0])
img = mpimg.imread(sample_image)
plt.figure(figsize=(10, 8))
plt.imshow(img)
plt.title('サンプル画像')
plt.axis('off')
plt.show()
```

## セル4: モデル学習の実行

```python
# モデル学習の実行
!python train.py --img 640 --batch 16 --epochs 50 --data ../dataset/kofun_dataset.yaml --weights yolov5s.pt --cache
```

## セル5: 学習結果の確認

```python
# 学習結果の確認
import matplotlib.pyplot as plt
from PIL import Image

print("📈 学習結果を確認中...")
try:
    # 学習曲線の表示
    results = Image.open('runs/train/exp/results.png')
    plt.figure(figsize=(12, 8))
    plt.imshow(results)
    plt.axis('off')
    plt.title('Training Results')
    plt.show()
except:
    print("学習結果の表示に失敗しました")
```

## セル6: 学習済みモデルのダウンロード

```python
# 学習済みモデルのダウンロード
from google.colab import files

print("💾 学習済みモデルをダウンロード中...")
try:
    files.download('runs/train/exp/weights/best.pt')
    files.download('runs/train/exp/weights/last.pt')
    print("✅ モデルファイルのダウンロード完了")
except:
    print("❌ モデルファイルのダウンロードに失敗しました")

print("🎉 学習完了！")
```

## 使用方法

1. Google Colabにアクセス: https://colab.research.google.com/
2. 新しいノートブックを作成
3. 上記のセルを順番にコピー&ペースト
4. データセットファイル `kofun_dataset_for_colab.zip` をアップロード
5. 各セルを実行
